@inject BDA.DataModel.DataEntities db
@inject BDA.DataModel.AppSettings appSet


@{
    //var mdl = new BDA.Models.MenuModels(db);
    var mdl = new BDA.Models.MenuDbModels(db, Microsoft.AspNetCore.Http.Extensions.UriHelper.GetDisplayUrl(db.httpContext.Request).ToLower());
    var map = mdl.GetSiteDbMap();
    var currentNode = mdl.GetCurrentNode();
    var currentNodeBreadcrumb = mdl.GetCurrentNodeBreadcrumb();

    string title = null;
    if (currentNode != null) { title = currentNode.Title; }
    if (ViewBag.HeaderTitle != null) { title = ViewBag.HeaderTitle; }

    BDA.Helper.CheckCookies.CheckValidCookiesLogin(db, appSet);
}

<!DOCTYPE html>
<html>

<head>

    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
    <meta charset="utf-8" />
 
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="apple-touch-icon" href="~/pages/ico/60.png">
    <link rel="apple-touch-icon" sizes="76x76" href="~/pages/ico/76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="~/pages/ico/120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="~/pages/ico/152.png">
    <link rel="icon" type="image/x-icon" href="~/favicon.ico" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta content="" name="description" />
    <meta content="" name="author" />

    <link rel="stylesheet" href="~/assets/fonts/fonts.css" />
    <link rel="stylesheet" href="~/assets/plugins/pace/pace-theme-flash.css" />
    <link rel="stylesheet" href="~/assets/plugins/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/assets/plugins/font-awesome/css/font-awesome.css" />
    <link rel="stylesheet" href="~/assets/plugins/jquery-scrollbar/jquery.scrollbar.css" />
    <link rel="stylesheet" href="~/assets/plugins/select2/css/select2.min.css" />
    <link rel="stylesheet" href="~/assets/plugins/switchery/css/switchery.min.css" />
    <link rel="stylesheet" href="~/pages/css/pages-icons.css" />
    <link rel="stylesheet" href="~/pages/css/pages.css" />
    <link rel="stylesheet" href="~/assets/css/custom.css" />

    @RenderSection("Scripts", required: false)

    @if (this.ViewContext.RouteData.Values["controller"].ToString() != "DXReport" && ViewBag.IsReport == null)
    {

        <link href="~/css/devextreme/dx.common.css" rel="stylesheet" />
        <link href="~/css/devextreme/dx.light.css" rel="stylesheet" />
        <script src="~/js/devextreme/jquery.js"></script>
        <script src="~/js/devextreme/cldr.js"></script>
        <script src="~/js/devextreme/cldr/event.js"></script>
        <script src="~/js/devextreme/cldr/supplemental.js"></script>
        <script src="~/js/devextreme/cldr/unresolved.js"></script>

        <script src="~/js/devextreme/globalize.js"></script>
        <script src="~/js/devextreme/globalize/message.js"></script>
        <script src="~/js/devextreme/globalize/number.js"></script>
        <script src="~/js/devextreme/globalize/currency.js"></script>
        <script src="~/js/devextreme/globalize/date.js"></script>
        <script src="~/js/devextreme/jszip.js"></script>
        <script src="~/js/devextreme/dx.all.js"></script>
        <script src="~/js/devextreme/vectormap-data/world.js"></script>
        <script src="~/js/devextreme/aspnet/dx.aspnet.data.js"></script>
        <script src="~/js/devextreme/aspnet/dx.aspnet.mvc.js"></script>


        <script src="~/js/devextreme/dx.messages.id.js"></script>
        <script>
            DevExpress.localization.locale("en");
        </script>
    }



</head>

<body class="fixed-header">
    <!-- style utk collapse/uncollapse card -->
    <style>
        .card-header .fa {
            transition: .3s transform ease-in-out;
        }

        .card-header .collapsed .fa {
            transform: rotate(90deg);
        }
    </style>
    <script>
        var pageTitle = "@(currentNode != null ? currentNode.Title : "")";
    </script>

    <div style="height: 100%; width: 100%;">
        <!-- BEGIN SIDEBAR -->
        <!-- BEGIN SIDEBPANEL-->
    
        <!-- END SIDEBAR -->
        <!-- START PAGE-CONTAINER -->
        <div class="page-container">
            <!-- START PAGE HEADER WRAPPER -->
            <!-- START HEADER -->
         
            <!-- END HEADER -->
            <!-- END PAGE HEADER WRAPPER -->
            <!-- START PAGE CONTENT WRAPPER -->
            <div class="page-content-wrapper">
                <!-- START PAGE CONTENT -->
                <div class="content">
                    <div class="container-fluid">
                        <!-- START BREADCRUMB -->
                   
                        <!-- END BREADCRUMB -->
                        @RenderBody()
                    </div>
                </div>

                <!-- END PAGE CONTENT -->
                <!-- START FOOTER -->
        
                <!-- END FOOTER -->
            </div>
            <!-- END PAGE CONTENT WRAPPER -->
        </div>

        <!-- END PAGE CONTAINER -->

        <script src="~/assets/plugins/jquery-ui/jquery-ui.min.js"></script>
        <script src="~/assets/plugins/pace/pace.min.js"></script>
        <script src="~/assets/plugins/modernizr.custom.js"></script>
        <script src="~/assets/plugins/tether/js/tether.min.js"></script>
        <script src="~/assets/plugins/bootstrap/js/bootstrap.min.js"></script>
        <script src="~/assets/plugins/jquery/jquery-easy.js"></script>
        <script src="~/assets/plugins/jquery-unveil/jquery.unveil.min.js"></script>
        <script src="~/assets/plugins/jquery-bez/jquery.bez.min.js"></script>
        <script src="~/assets/plugins/jquery-ios-list/jquery.ioslist.min.js"></script>
        <script src="~/assets/plugins/imagesloaded/imagesloaded.pkgd.min.js"></script>
        <script src="~/assets/plugins/pace/pace.min.js"></script>
        <script src="~/assets/plugins/jquery-actual/jquery.actual.min.js"></script>
        <script src="~/assets/plugins/jquery-scrollbar/jquery.scrollbar.min.js"></script>
        <script src="~/assets/plugins/classie/classie.js"></script>
        <script src="~/pages/js/pages.js"></script>
        <script src="~/assets/js/scripts.js"></script>
        <script src="~/assets/js/sweetalert2.all.js"></script>
        <script src="~/assets/js/polyfill.min.js"></script>
        <script src="~/assets/js/wsscripts.js"></script>
        @{
            var scriptText = "";
            if (db.GetSessionString("errtext") != null)
            {
                scriptText += "<script>jQuery(document).ready(function () {swal({type: 'error', title: 'Oops...',  html: '" + (db.GetSessionString("errtext").Replace("'", "\\'").Replace(Environment.NewLine, "<br />")) + "',})});</script>";
                db.RemoveSession("errtext");
            }
            else if (db.GetSessionString("sctext") != null)
            {
                scriptText += "<script>jQuery(document).ready(function () {swal({type: 'success', title: 'Success',  html: '" + (db.GetSessionString("sctext").Replace("'", "\\'")) + "',})});</script>";
                db.RemoveSession("sctext");
            }
            else if (db.GetSessionString("warntext") != null)
            {
                scriptText += "<script>jQuery(document).ready(function () {swal({type: 'warning', title: 'Warning',  html: '" + (db.GetSessionString("warntext").Replace("'", "\\'")) + "',})});</script>";
                db.RemoveSession("warntext");
            }
        }
        @Html.Raw(scriptText)


        @(Html.DevExtreme().Popup()
                .ID("popupMain")
                .WrapperAttr(new { @class = "popup" })//.ElementAttr("class", "popup")
                .ShowTitle(true)
                .Visible(false)
                .DragEnabled(true)
                .ResizeEnabled(true)
                .CloseOnOutsideClick(true)
                .ContentTemplate(@<text>
                            <iframe src="" id="popupContainer" frameborder="0" style="overflow:hidden;height:100%;width:100%" height="100%" width="100%"></iframe>
                </text>)
         .OnHiding("PopupOnHiding")
        )
        @(Html.DevExtreme().Popup()
                .ID("popupMain2")
                .WrapperAttr(new { @class = "popup" })//.ElementAttr("class", "popup")
                .ShowTitle(true)
                .Visible(false)
                .DragEnabled(true)
                .ResizeEnabled(true)
                .CloseOnOutsideClick(true)
                .ContentTemplate(@<text>
                            <iframe src="" id="popupContainer2" frameborder="0" style="overflow:hidden;height:100%;width:100%" height="100%" width="100%"></iframe>
                </text>)
         .OnHiding("PopupOnHiding2")
        )
        @(Html.DevExtreme().Popup()
                .ID("popupMain3")
                .WrapperAttr(new { @class = "popup" })//.ElementAttr("class", "popup")
                .ShowTitle(true)
                .Visible(false)
                .DragEnabled(true)
                .ResizeEnabled(true)
                .CloseOnOutsideClick(true)
                .ContentTemplate(@<text>
                            <iframe src="" id="popupContainer3" frameborder="0" style="overflow:hidden;height:100%;width:100%" height="100%" width="100%"></iframe>
                </text>)
         .OnHiding("PopupOnHiding3")
        )
        <script>
            function ShowPopupMain(url, title, width, height, closingFunction) {
                var popup = $("#popupMain").dxPopup("instance");
                popup.option("width", width);
                popup.option("height", height);
                popup.option("title", title);
                if (typeof (closingFunction) != 'undefined') {
                    myClosingFunction = closingFunction;
                } else {
                    myClosingFunction = null
                }

                popup.show();
                document.getElementById('popupContainer').src = url;
            }

            var myClosingFunction;
            function ClosePopup(msg) {
                var popup1 = $("#popupMain").dxPopup("instance");
                var popup2 = $("#popupMain2").dxPopup("instance");
                var popup3 = $("#popupMain3").dxPopup("instance");
                if (popup3.option('visible') == true) {
                    popup3.hide();
                    setTimeout(function () {
                        alert(msg);
                        if (myClosingFunction3 != null) {
                            myClosingFunction3();
                        }
                    }, 200);
                }else if (popup2.option('visible') == true) {
                    popup2.hide();
                    setTimeout(function () {
                        alert(msg);
                        if (myClosingFunction2 != null) {
                            myClosingFunction2();
                        }
                    }, 200);
                }else {
                    popup1.hide();
                    setTimeout(function () {
                        alert(msg);
                        if (myClosingFunction != null) {
                            myClosingFunction();
                        }
                    }, 200);
                }
            }

            function ShowPopupMain2(url, title, width, height, closingFunction) {
                var popup = $("#popupMain2").dxPopup("instance");
                if (popup.option('visible') == true) {
                    //popup2 sudah open, artinya waktunya popup3
                    ShowPopupMain3(url, title, width, height, closingFunction);
                } else {
                    popup.option("width", width);
                    popup.option("height", height);
                    popup.option("title", title);
                    if (typeof (closingFunction) != 'undefined') {
                        myClosingFunction2 = closingFunction;
                    } else {
                        myClosingFunction2 = null
                    }

                    popup.show();
                    document.getElementById('popupContainer2').src = url;
                }
            }

            function ShowPopupMain3(url, title, width, height, closingFunction) {
                var popup = $("#popupMain3").dxPopup("instance");
                popup.option("width", width);
                popup.option("height", height);
                popup.option("title", title);
                if (typeof (closingFunction) != 'undefined') {
                    myClosingFunction3 = closingFunction;
                } else {
                    myClosingFunction3 = null
                }

                popup.show();
                document.getElementById('popupContainer3').src = url;
            }

            function PopupOnHiding(e) {
                document.getElementById('popupContainer').src = "";
            }
            function PopupOnHiding2(e) {
                document.getElementById('popupContainer2').src = "";
            }
            function PopupOnHiding3(e) {
                document.getElementById('popupContainer3').src = "";
            }
        //important! to complement AutoValidateAntiforgeryTokenAttribute
        if ($('input:hidden[name="__RequestVerificationToken"]').length) {
            $.ajaxSetup({
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("XSRF-TOKEN", $('input:hidden[name="__RequestVerificationToken"]').val());
                }
            });


        }
        $(document).ready(function () {
            //Disable autocomplete throughout the site
            $("input:text,form").attr("autocomplete", "off");

            //set time
            var myTime;
            myTime = new Date('@DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss", System.Globalization.CultureInfo.InvariantCulture)');
            SetCurrentTime(myTime);
            //ShowTime();

        });

        function MarkNoticeRead() {
            var ask = confirm('Apakah Anda yakin akan mengubah status read ?');
            if (ask) {
                $.ajax({
					type: "POST",
					url: "@Url.Action("MarkNoticeRead","Email",new {area = "FW" })",
					contentType: "application/x-www-form-urlencoded;charset=UTF-8",
                    dataType: "json",
                    data: "param1=1",
                    success: function (response) {
                        alert(response);
                        $("#notice_bubble").hide();
                    },
                    error: function (response) {
                        alert(response.responseJSON.error);
                    }
				});
            }
        }
        </script>
    </div>
</body>

</html>
